# 사용자 모드 & 커널 모드

`운영체제(Operating System)`는 컴퓨터 하드웨어와 소프트웨어를 관리하고, 사용자가 시스템 자원을 효율적으로 사용할 수 있도록 돕는 소프트웨어이다.
운영체제의 여러 기능 중 핵심 기능을 담당하는 부분을 `커널(kernel)`이라고 한다.

![image](https://github.com/user-attachments/assets/98daec89-c413-480e-857c-23d389c8aaf7)
  
운영체제는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호한다.  
만약 응용 프로그램이 하드웨어 자원에 직접 접근해서 조작할 수 있다면 자원 관리가 되지 않고 프로세스 간 데이터가 훼손되어 컴퓨터 시스템 전체에 오류를 가져오게 된다.
응용 프로그램이 하드웨어 자원에 접근하려고 할 때는 반드시 운영체제를 통해서만 접근하도록 해야한다.

## CPU 권한 모드

CPU는 명령어를 실행할 때 `사용자 모드(user mode)`와 `커널 모드(kernel mode)`로 구분한다.  
CPU는 동작하는 동안 두가지 모드를 번갈아 가며 수행한다.

![image](https://github.com/user-attachments/assets/8669b46d-90fb-4489-94f3-00ce8fef23e0)

### 사용자 모드 (Mode Bit=1)

사용자 응용프로그램 코드가 실행되는 모드로써 제한된 권한을 가지고 있고 메모리의 유저영역만 접근 가능하다.  
디스크, 메모리 및 여러 I/O 장치들과 같은 특정 자원에 직접 접근할 수 없다.
  
대부분의 응용프로그램은 입출력 장치나 파일로의 접근이 필요한데 이 때는 유저모드에서 커널모드로의 전환이 되어야 한다.

### 커널 모드 (Mode Bit=0)

커널 영역의 코드가 실행되는 모드로써 메모리의 유저영역, 커널영역에 모두 접근 가능하다.  
하드웨어 자원에 직접 접근할 수 있다.

## 시스템 호출(System Call)

응용 프로그램이 운영체제의 커널이 제공하는 기능을 이용할 수 있도록 커널 모드에 접근하기 위한 인터페이스이다.  
응용 프로그램이 시스템 자원이나 하드웨어에 접근하기 위해서는 커널모드의 CPU가 실행해야 하며, 반드시 시스템 콜을 통해 사용자 모드에서 커널 모드로 전환해야 한다.

![image](https://github.com/user-attachments/assets/de90d5ee-b35f-4370-98ad-df611e6c4ce2)

  
사용자 응용 프로그램은 작업 과정에서 커널의 기능을 사용하기 위해 매우 빈번하게 시스템 콜을 요청하고 이로 인해 사용자 모드와 커널 모드를 상호 전환하며 실행하게 된다.
I/O 처리를 위해 사용자 모드와 커널 모드를 번갈아 오가는 것은 컨텍스트 스위칭과 관련이 있으며, 멀티 스레드 환경에서 숙지해야 할 중요한 배경 지식이다.

---

### Reference
- [자바 동시성 프로그래밍 \[리액티브 프로그래밍 Part.1\]](https://www.inflearn.com/course/%EC%9E%90%EB%B0%94-%EB%8F%99%EC%8B%9C%EC%84%B1-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EB%A6%AC%EC%95%A1%ED%8B%B0%EB%B8%8C-part1/dashboard)
